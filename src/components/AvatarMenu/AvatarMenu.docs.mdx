# AvatarMenu

> **Component**: Contextual menu associated with the authenticated user — avatar + menu

The **`AvatarMenu`** is a components component designed to display a **contextual menu**
associated with the authenticated user's avatar. It's built with **React**,
**TypeScript**, and **Material UI (MUI)**, and encapsulates the access, focus,
and components logic using the `useAvatarMenu` hook.

---

## Goals and Scope

- Provide a visual trigger (avatar) that opens an **accessible menu** with
  user-related actions (profile, settings, logout).
- Ensure **keyboard components** and compatibility with screen readers.
- Be flexible and customizable via `menuItems`, `avatarProps`, and `fullWidth`.
- Maintain separation of concerns: logic in the hook, UI in the JSX,
  styles in the `styles` file.

---

## Props and API

## Manual Props

<table>
  <thead>
    <tr>
      <th>Prop</th>
      <th>Type</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>avatarUrl</td>
      <td>
        <code>string</code>
      </td>
      <td>Yes</td>
      <td>URL of the avatar image</td>
    </tr>
    <tr>
      <td>username</td>
      <td>
        <code>string</code>
      </td>
      <td>Yes</td>
      <td>Username for aria-label</td>
    </tr>
    <tr>
      <td>menuItems</td>
      <td>
        <code>AvatarMenuItem[]</code>
      </td>
      <td>No</td>
      <td>List of menu items</td>
    </tr>
    <tr>
      <td>avatarProps</td>
      <td>
        <code>Omit&lt;MuiAvatarProps, 'src' | 'alt'&gt;</code>
      </td>
      <td>No</td>
      <td>Additional props for MUI Avatar</td>
    </tr>
    <tr>
      <td>fullWidth</td>
      <td>
        <code>boolean</code>
      </td>
      <td>No</td>
      <td>Whether the trigger takes up the full width</td>
    </tr>
    <tr>
      <td>data-testid</td>
      <td>
        <code>string</code>
      </td>
      <td>No</td>
      <td>Identifier for testing</td>
    </tr>
  </tbody>
</table>

### `AvatarMenuItem` Structure

Each menu item has the following (simplified) shape:

```ts
interface AvatarMenuItem {
  label: string;
  onClick: () => void;
  icon?: React.ReactNode;
  disabled?: boolean;
  divider?: boolean;
  'data-testid'?: string;
  menuItemProps?: Omit<MuiMenuItemProps, 'onClick'>;
  key?: 'profile' | 'settings' | 'logout' | string;
}
```

---

## Accessibility (A11y)

- `aria-haspopup="true"` and `aria-expanded` on the trigger.
- `aria-controls` on the trigger pointing to the `menuId` when open.
- `aria-labelledby` on the `MenuList` pointing to the trigger to link readings by screen-readers.
- Keyboard handling:
  - **`Enter`** or **`Space`**: opens the menu from the trigger.
  - **`Escape`**: closes the menu and restores focus.
  - **`ArrowDown`** / **`ArrowUp`**: navigates between items.
- **`MenuItem`**s respect **`disabled`** and expose **`aria-disabled`**.
- **`focusedIndex`** and **`autoFocus`** are used to indicate visual focus at the item level.

---

## Styles and Tokens

- **`AvatarMenuRoot`** controls `width`, `padding`, and `borderRadius`.
- **`AvatarContainer`** is a flex container with gap dependent on `theme.spacing`.
- **`TriangleIndicator`** is a CSS triangle that rotates based on `$isOpen` — animation via `theme.transitions`.
- **`UsernameText`** is hidden on small screens using breakpoints.

Reference Tokens (examples):

- `theme.palette.text.primary`
- `theme.shape.borderRadius`
- `theme.spacing(0.5)` / `theme.spacing(1.25)`

---

## Visual Behavior and UX

- The menu is anchored with `anchorOrigin` and `transformOrigin` to `bottom/right` -> `top/right`.
- **`MenuListProps.autoFocus`** for automatic focus on opening and **`dense`** to compact the list.
- **`MenuItem`** applies `sx` when focused (shadow, border, borderRadius).
- **`menuItemProps.sx`** is respected if provided.

---

## Testing (Summary of Existing Suite)

- Initial rendering with `aria-expanded=false`.
- Opening / closing by click and verification of the `menu` role.
- Execution of item's `onClick` and subsequent closing.
- Use of **`DEFAULT_AVATAR_MENU_ITEMS`** if no `menuItems` are passed.
- Behavior with empty **`avatarUrl`** (fallback).
- Menu with disabled items (`aria-disabled`).
- **`fullWidth`** propagation and DOM structure.

---

## Included Stories

# AvatarMenu - Stories

> Links to each individual story for the AvatarMenu component.

<a href="?/iframe.html?globals=&id=components-avatarmenu--standard">
  Standard — Standard menu with default items
</a>
<br />
<a href="?/iframe.html?globals=&id=components-avatarmenu--custom-actions&viewMode=story">
  CustomActions — Menu with custom items
</a>
<br />
<a href="?/iframe.html?globals=&args=&id=components-avatarmenu--avatar-fallback&viewMode=story">
  AvatarFallback — No avatar image
</a>
<br />
<a href="?/iframe.html?globals=&args=&id=components-avatarmenu--empty-menu&viewMode=story">
  EmptyMenu — Empty menu
</a>
<br />
<a href="?/iframe.html?globals=&args=&id=components-avatarmenu--disabled-items&viewMode=story">
  DisabledItems — Disabled items
</a>
<br />
<a href="?/iframe.html?globals=&args=&id=components-avatarmenu--layout-variants&viewMode=story">
  LayoutVariants — fullWidth and without username
</a>

---

## Usage Examples

```tsx
<AvatarMenu
  avatarUrl="/images/user.jpg"
  username="Alex Méndez"
  menuItems={[
    { label: 'Profile', onClick: () => navigate('/profile') },
    { label: 'Log Out', onClick: logout, divider: true },
  ]}
/>
```

```tsx
<AvatarMenu
  avatarUrl=""
  username="User"
  avatarProps={{ sx: { width: 36, height: 36 } }}
  menuItems={[
    { label: 'Dark Mode', onClick: toggleDarkMode },
    { label: 'Support', onClick: openHelp },
  ]}
  fullWidth
/>
```

---
